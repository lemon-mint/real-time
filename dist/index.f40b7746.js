const timeH1=document.getElementById("time"),errorPre=document.getElementById("error"),errordiv=document.getElementById("error-div"),stat=document.getElementById("status");let timeOffset=0,errorString="",DOMTimeOff=(new Date).getTime()-performance.now(),displayTime=(new Date).toLocaleString(),statusText="Please wait, synchronizing...";function getCurrentTime(){return performance.now()+DOMTimeOff+timeOffset}function updateTime(){const e=getCurrentTime(),t=new Date(e);displayTime=t.toLocaleString(),timeH1.textContent!==displayTime&&(timeH1.textContent=displayTime),errorString?(errordiv.hidden=!1,errorPre.innerText=errorString):errordiv.hidden||(errordiv.hidden=!0),stat.textContent!==statusText&&(stat.textContent=statusText),requestAnimationFrame(updateTime)}function setTimeOffset(e){timeOffset+=e}async function getServerOff(){const e=getCurrentTime(),t=await fetch("/time"),n=getCurrentTime(),r=await t.json();return(r.t1-e+r.t2-n)/2}async function sleep(e){return new Promise((t=>setTimeout(t,e)))}async function syncTime(e=!1,t=1){await getServerOff();let n=0;for(let e=0;e<10;e++){console.log("Measurement: "+e),console.log("Requesting time offset...");const t=await getServerOff();n+=t,console.log("Server offset: "+t),statusText="Synchronizing... "+(n/(e+1)).toFixed(5)+"ms",await sleep(20)}n/=10,n*=t,console.log("Synchronized time offset: "+n),setTimeOffset(n),statusText=(getCurrentTime()-(new Date).getTime()).toFixed(5)+"ms",e&&(setTimeout((async()=>{await syncTime(!0,t)}),3e4),console.log("Next Synchronization is scheduled on "+new Date(getCurrentTime()+3e4).toLocaleString()))}async function main(){try{errorString="",statusText="Please wait, synchronizing...",console.log("Starting synchronization..."),await getServerOff(),await sleep(500),await syncTime(!1),await sleep(100),await syncTime(!0,.9),console.log("Successfully synchronized time.")}catch(e){console.error(e),errorString=e.toString(),statusText="Error occurred. Restarting in 5 seconds.",setTimeout(main,5e3)}}requestAnimationFrame(updateTime),main().then();
//# sourceMappingURL=index.f40b7746.js.map
