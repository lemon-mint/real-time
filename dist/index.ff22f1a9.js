const timeH1=document.getElementById("time"),errorPre=document.getElementById("error"),errordiv=document.getElementById("error-div"),stat=document.getElementById("status");let timeOffset=0,errorString="",DOMTimeOff=(new Date).getTime()-performance.now(),displayTime=(new Date).toLocaleString(),statusText="잠시 기다려주세요, 동기화 중입니다.";function getCurrentTime(){return performance.now()+DOMTimeOff+timeOffset}function updateTime(){const e=getCurrentTime(),t=new Date(e);displayTime=t.toLocaleString(),timeH1.textContent!==displayTime&&(timeH1.textContent=displayTime),errorString?(errordiv.hidden=!1,errorPre.innerText=errorString):errordiv.hidden||(errordiv.hidden=!0),stat.textContent!==statusText&&(stat.textContent=statusText),requestAnimationFrame(updateTime)}function setTimeOffset(e){timeOffset+=e}async function getServerOff(){const e=getCurrentTime(),t=await fetch("/time"),n=getCurrentTime(),i=await t.json();return(i.t1-e+i.t2-n)/2}async function sleep(e){return new Promise((t=>setTimeout(t,e)))}async function syncTime(e=!1){await getServerOff();let t=0;for(let e=0;e<10;e++)t+=await getServerOff(),statusText="동기화중... "+(t/(e+1)).toFixed(5)+"ms",await sleep(25);t/=10,console.log("offset: "+t),setTimeOffset(t),statusText=(getCurrentTime()-(new Date).getTime()).toFixed(5)+"ms",e&&setTimeout((async()=>{await syncTime(!0)}),3e4)}async function main(){await getServerOff(),await sleep(500),await syncTime(!1),await sleep(1e3),await syncTime(!0)}requestAnimationFrame(updateTime),main().then();
//# sourceMappingURL=index.ff22f1a9.js.map
